<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bedrock Pattern Coordinate Tool</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; }
  td { width: 32px; height: 32px; border: 1px solid #555; cursor: pointer; text-align:center; }
  td.on { background: #333; color:white; }
  td.off { background: #ddd; color:#333; }
  #container { display:flex; gap:20px; }
</style>
</head>
<body>
<h1>Bedrock Pattern Coordinate Tool</h1>
<p>Click to toggle each bedrock block. Black = bedrock, gray = air.</p>

<div id="container">
  <table id="grid"></table>

  <div style="flex:1;">
    <h2>Pattern Import / Export</h2>
    <button id="exportPattern">Export Pattern JSON</button>
    <button id="importPatternBtn">Import Pattern JSON</button>
    <input id="importPatternFile" type="file" accept="application/json" style="display:none;" />
    <textarea id="patternBox" style="width:100%;height:120px;margin-top:10px;font-family:monospace;"></textarea>
  </div>
</div>

<hr>
<h2>Seed Input (Optional)</h2>
<p>Enter a world seed. This will be embedded into the coordinate output JSON.</p>
<input id="seedInput" type="text" style="width:260px;font-size:15px;padding:4px;" placeholder="Enter seed (number or text)" />

<hr>
<h2>Coordinate Output</h2>
<p>Deterministic pseudo-coordinates computed locally from the 5×5 pattern.</p>
<button id="calcCoords">Compute Coordinates</button>
<button id="downloadCoords">Download Coords JSON</button>
<textarea id="coordOutput" style="width:100%;height:150px;margin-top:12px;font-family:monospace;"></textarea>

<script>
  // Build 5×5 grid
  const grid = document.getElementById('grid');
  const size = 5;

  for(let r=0; r<size; r++){
    const row = document.createElement('tr');
    for(let c=0; c<size; c++){
      const cell = document.createElement('td');
      cell.dataset.row = r;
      cell.dataset.col = c;
      cell.classList.add('off');
      cell.onclick = () => {
        cell.classList.toggle('on');
        cell.classList.toggle('off');
      };
      row.appendChild(cell);
    }
    grid.appendChild(row);
  }

  function getPattern(){
    const pattern = [];
    for(let r=0; r<size; r++){
      const row = [];
      for(let c=0; c<size; c++){
        const cell = grid.rows[r].cells[c];
        row.push(cell.classList.contains('on') ? 1 : 0);
      }
      pattern.push(row);
    }
    return pattern;
  }

  function loadPattern(pat){
    for(let r=0; r<size; r++){
      for(let c=0; c<size; c++){
        const cell = grid.rows[r].cells[c];
        if (pat[r][c] === 1){
          cell.classList.add('on');
          cell.classList.remove('off');
        } else {
          cell.classList.add('off');
          cell.classList.remove('on');
        }
      }
    }
  }

  // Export Pattern
  document.getElementById('exportPattern').onclick = () => {
    const pat = getPattern();
    document.getElementById('patternBox').value = JSON.stringify(pat, null, 2);
  };

  // Import Pattern
  document.getElementById('importPatternBtn').onclick = () => {
    document.getElementById('importPatternFile').click();
  };

  document.getElementById('importPatternFile').onchange = async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const text = await file.text();
    try {
      const pat = JSON.parse(text);
      loadPattern(pat);
      document.getElementById('patternBox').value = JSON.stringify(pat, null, 2);
    } catch(err){ console.error(err); }
  };

  // Deterministic coordinate generator
  function patternToCoords(pattern){
    let flat = pattern.flat().join('');
    let num = 0;
    for(let i=0; i<flat.length; i++){
      num = (num * 31 + (flat[i] === '1' ? 7 : 3)) >>> 0;
    }
    const x = (num % 20000000) - 10000000;
    const z = ((num / 17 >>> 0) % 20000000) - 10000000;
    return { x, z, hash: num };
  }

  const coordOut = document.getElementById('coordOutput');

  // Compute Coordinates
  document.getElementById('calcCoords').onclick = () => {
    const pat = getPattern();
    const coords = patternToCoords(pat);
    const seed = document.getElementById('seedInput').value || null;

    coordOut.value = JSON.stringify({
      seed: seed,
      coords: coords,
      pattern: pat
    }, null, 2);
  };

  // Download Coordinates JSON
  document.getElementById('downloadCoords').onclick = () => {
    const pat = getPattern();
    const coords = patternToCoords(pat);
    const seed = document.getElementById('seedInput').value || null;

    const obj = { seed: seed, coords: coords, pattern: pat };

    const blob = new Blob([JSON.stringify(obj, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'coords-with-seed.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  };
</script>

</body>
</html>
